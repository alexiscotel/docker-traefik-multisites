version: "3.8"
services:

    www:
        build: php
        container_name: www_site1
        volumes:
            - ./php/vhosts:/etc/apache2/sites-enabled
            - ./:/var/www
        restart: always
        networks:
            - traefik #add 1st so traefik performs better
            - site1network
        labels:
            - "traefik.enable=true"
            # http
            - "traefik.http.routers.http_site1_com.rule=Host(`site1.com`)"
            - "traefik.http.routers.http_site1_com.entrypoints=http"
            # https
            - "traefik.http.routers.https_site1_com.rule=Host(`site1.com`)"
            - "traefik.http.routers.https_site1_com.entrypoints=https"
            - "traefik.http.routers.https_site1_com.tls=true"
            - "traefik.http.routers.https_site1_com.tls.certresolver=myresolver"

            - "traefik.http.services.site1_com.loadbalancer.server.port=80"

networks:
    site1network:
    traefik:
        external:
            name: traefik_global